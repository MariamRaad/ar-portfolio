<!DOCTYPE html>
<html>

<head>
    <title> AR Portfolio - Mariam Raad </title>
    <meta charset="utf-8">
    <meta name="description" content="AR.js Portfolio">
    <meta name="author" content="Mariam Raad">
	
    <link rel="icon" type="image/png" href="assets/images/favicon/favicon.png">

    <!--  this is REQUIRED for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, user-scalable=no"> <!-- , minimum-scale=1.0, maximum-scale=2.0 -->

    <!-- AFrame -->
    <!-- <script src="https://aframe.io/releases/0.9.2/aframe.min.js    https://cdn.jsdelivr.net/gh/aframevr/aframe@cd01cec35a01e03eb2d6a9272500a53de31d3828/dist/aframe-master.min.js"></script> -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <!-- ARjs -->
    <!-- Version without NFT/image tracking but with marker + location based support -->
    <!-- <script src="https://raw.githack.com/jeromeetienne/AR.js/2.2.2/aframe/build/aframe-ar.min.js   https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js   https://raw.githack.com/AR-js-org/AR.js/3.1.0/aframe/build/aframe-ar.js"></script> -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.1.0/aframe/build/aframe-ar.js"></script>

    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="https://mariamraad.github.io/ar-portfolio/style.css">
    <!-- https://mariamraad.github.io/ar-portfolio/style.css  /style.css -->

    <!-- import Scripts to add functionality -->
    <!-- <script src="https://mariamraad.github.io/ar-portfolio/events.js"></script> -->
    <!-- <script src="https://mariamraad.github.io/ar-portfolio/cursor.js" defer></script> -->
    <!-- <script src="https://mariamraad.github.io/ar-portfolio/gesture-detector.js"></script> -->
    <!-- <script src="https://mariamraad.github.io/ar-portfolio/gesture-handler.js"></script> -->
    <!-- <script src="https://mariamraad.github.io/ar-portfolio/cursor.js" defer></script> -->
    <!-- the "defer" attribute tells the browser that the script is meant to be executed after the document has been parsed -->

    <script>
    AFRAME.registerComponent('ar-session-notifier', {
        init: function() {
        	var scene = this.el.sceneEl
            var arSession = null
            // wait until the arSession is ready
            var idx = setInterval(function() {
                arSession = scene.systems["arjs"]._arSession
                if (!arSession) return;
                scene.emit("arSessionReady")
                clearInterval(idx)
            })
        }
    })

    AFRAME.registerComponent('foo', {
        init: function() {
            // the clicks may fire prematurely for some reason ¯\_(ツ)_/¯
            this.el.sceneEl.addEventListener("arSessionReady", this.addListeners.call(this));
        },
        addListeners: function() {
            let toggle = false
	    this.vid = document.querySelector("#Video_Asset_0"); //videoScreen Video_Asset_0
		
            this.el.addEventListener("click", e => {
                /*
		if (toggle)
                    this.el.setAttribute('material', 'color', 'red')
                else
                    this.el.setAttribute('material', 'color', 'green')
		    
                toggle = !toggle
		*/
		this.vid.play();
            })
        }
    })
	    
    AFRAME.registerComponent('videohandler', {
        init: function() {
            // the clicks may fire prematurely for some reason ¯\_(ツ)_/¯
            this.el.sceneEl.addEventListener("arSessionReady", this.addListeners.call(this));
        },
        addListeners: function() {
            //let vid = document.querySelector("#Video_Asset_0");
	    this.el.addEventListener("click", e => {
                 this.el.play();
            })
        }
    })

    AFRAME.registerComponent('cursor-hack', {
        init: function() {
            var scene = this.el

            // wait until the arSession is ready
            scene.addEventListener("arSessionReady", function() {
                var arSession = scene.systems["arjs"]._arSession
                // helpers
                var raycaster = new THREE.Raycaster();
                var mouse = new THREE.Vector2();
                // useful references
                var cursorElement = document.querySelector("[cursor]")
                var arToolkitContext = arSession.arContext
                var camera = scene.camera

                function mousedown(event) {
                    // core of this 'hack' - using the arToolkitContext projection matrix
                    camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
                    camera.projectionMatrixInverse.getInverse(camera.projectionMatrix);

                    var point
                    if (event.type === "touchmove" || event.type === "touchstart") {
                        // Track the first touch for simplicity.
                        point = event.touches.item(0);
                    } else {
                        point = event;
                    }
                    // Calculate mouse position based on the canvas element
                    var rect = scene.renderer.domElement.getBoundingClientRect();
                    mouse.x = ((point.clientX - rect.left) / rect.width) * 2 - 1
                    mouse.y = -((point.clientY - rect.top) / rect.height) * 2 + 1
                    raycaster.setFromCamera(mouse, camera);
                    // if there are any intersections - send the clicks
                    var intersects = raycaster.intersectObjects(scene.object3D.children, true);
                    if (intersects.length > 0) {
                        // this click is stripped of any info it should have
                        intersects[0].object.el.emit("click")
                    }
                    event.stopPropagation();
                }
                window.addEventListener('mousedown', mousedown, false);
                //window.addEventListener('touchstart', mousedown, false);
            })
        }
    })
    </script>	
</head>

<body>
    <!-- Logo -->
    <div class="logoWrapper">
        <input id="logo" type="image" class="logoImage" src="https://mariamraad.github.io/ar-portfolio/assets/images/logo/Logo_MandR_Schrift.png"></input>
    </div> 
	
    <!-- Scanner Bild 	
    <div class="scannerWrapper">
	<input id="scanner" type="image" class="scannerImage" src="https://mariamraad.github.io/ar-portfolio/assets/images/scanner/Scanner_ohneHintergrund_Text.png"/>
    </div>-->
	
    <!-- cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;' raycaster="objects: [clickhandler];" -->
    <!-- renderer="antialias: true; alpha: true; precision: mediump;"  embedded arjs="sourceType: webcam;"  -->
	<!-- vr-mode-ui="enabled: false;" embedded arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; patternRatio: 0.8" -->
    <a-scene id="scene1" ar-session-notifier cursor-hack embedded arjs="trackingMethod: best; sourceType: webcam; patternRatio: 0.8 debugUIEnabled: false;" vr-mode-ui="enabled: false;">
	
	<a-assets>
            <img id="play_btn" src="https://mariamraad.github.io/ar-portfolio/assets/images/buttons/Play.png">
            <img id="description_SafeNetKids" src="https://mariamraad.github.io/ar-portfolio/assets/images/texts/Beschreibung_SafeNetKids.png">
            <video id="Video_Asset_0" src="https://mariamraad.github.io/ar-portfolio/assets/videos/SafeNetKids_compressed3.mp4" type="video/mp4" preload="auto" response-type="arraybuffer" loop crossorigin webkit-playsinline autoplay playsinline></video> 	        
	</a-assets> 

        <!-- <a-marker-camera preset='hiro' registerevents cursor="rayOrigin: mouse" -->
        <!-- cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 0;" raycaster="objects: [clickhandler]; raycaster="objects: .intersectable" -->
	<!-- scannerhandler markerhandler-->
        <a-marker emitevents="true" id="marker" preset="custom" type="pattern" url="https://mariamraad.github.io/ar-portfolio/assets/images/markers/pattern.patt" smooth="true" smoothCount="10" smoothTolerance="0.02" smoothThreshold="2"> <!--size="10"-->
		<!-- <a-video id="videoScreen" src="#Video_Asset_0" position="0 0.5 0" rotation="270 0 0" width="2" height="1.5"></a-video> <!-- play="true" -->
		<!-- <a-image position="0 2 0" rotation ="0 0 0" width="2" height="1" src="#my-image"></a-image> -->
		
		<!-- <a-box position="0 0.5 0" color-randomizer></a-box> -->
		<!-- <a-box position="1.5 0 0" scale="0.5 0.5 0.5" rotation="0 0 0" material="color: red; opacity: 0.5" foo></a-box> -->
            	<!-- <a-plane width="0.5" height="0.5" position="1 2.5 0" rotation="-45 0 0" material="color: blue; opacity: 0.5" foo></a-plane> -->
		<a-plane material="src: #play_btn;" position="1.5 0 0" rotation="270 0 0" height="0.75" width="0.75" foo></a-plane>
		<a-plane material="src: #description_SafeNetKids;" position="0 0 2" rotation="270 0 0" height="2" width="2"></a-plane>
		<a-plane material="src: #Video_Asset_0;" position="0 0.5 0" rotation="270 0 0" height="1.5" width="2"></a-plane>
		
		<!--
		<a-entity
      			  id="videoScreen"
			  geometry="primitive: plane; width: 1.5; height: 1.5"
			  material="shader: flat; side: double; src: #Video_Asset_0"
			  position="0 0.5 0" 
			  rotation="270 0 0"
			  videohandler
		>
		</a-entity>
		-->
        </a-marker>
	    
	<!-- static camera that moves according to the device movemenents -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
